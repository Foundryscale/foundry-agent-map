<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>THE GRID — FoundryScale Agent Engine</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Barlow+Semi+Condensed:wght@400;500;600;700&family=Chakra+Petch:wght@400;500;600;700&family=JetBrains+Mono:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
/* ==========================================================================
   THE GRID — FoundryScale Agent Engine Dashboard
   A "Control Room" aesthetic for AI agent operations.
   ========================================================================== */

:root {
  /* --- Base palette --- */
  --base: #060E15;
  --surface: #0B1926;
  --surface-2: #0F2234;
  --border: #1B3A52;
  --border-subtle: #142D42;

  /* --- Brand accent --- */
  --mint: #7ED9B6;
  --mint-glow: rgba(126,217,182,0.12);
  --mint-bright: #A3E8CF;

  /* --- Status colors --- */
  --shipped: #34D399;
  --building: #FBBF24;
  --backlog: #64748B;
  --concept: #A78BFA;
  --urgent: #F87171;

  /* --- Text hierarchy --- */
  --text: #E2EBF3;
  --text-dim: #6B8BA4;
  --text-muted: #3D5A73;

  /* --- Layer colors --- */
  --layer-architect: #60A5FA;
  --layer-builder: #FBBF24;
  --layer-validator: #F87171;
  --layer-pm: #7ED9B6;
  --layer-scout: #2DD4BF;
  --layer-librarian: #A78BFA;
}

/* --- Reset --- */
*, *::before, *::after {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  font-size: 14px;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

body {
  font-family: 'Barlow Semi Condensed', sans-serif;
  background: var(--base);
  color: var(--text);
  min-height: 100vh;
  overflow-x: hidden;
  /* Dot grid texture echoing "THE GRID" */
  background-image: radial-gradient(circle, rgba(126,217,182,0.03) 1px, transparent 1px);
  background-size: 28px 28px;
}

/* --- Scrollbar --- */
::-webkit-scrollbar { width: 5px; height: 5px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }
::-webkit-scrollbar-thumb:hover { background: var(--text-muted); }

/* --- Font helpers --- */
.font-display { font-family: 'Chakra Petch', sans-serif; }
.font-label { font-family: 'Barlow Semi Condensed', sans-serif; }
.font-mono { font-family: 'JetBrains Mono', monospace; }

/* ==========================================================================
   KEYFRAMES
   ========================================================================== */

@keyframes fadeSlideIn {
  from { opacity: 0; transform: translateY(12px); }
  to   { opacity: 1; transform: translateY(0); }
}

@keyframes pulseLive {
  0%, 100% { box-shadow: 0 0 0 0 rgba(52,211,153,0.5); }
  50%      { box-shadow: 0 0 0 6px rgba(52,211,153,0); }
}

@keyframes pulseGlow {
  0%, 100% { opacity: 0.3; }
  50%      { opacity: 0.6; }
}

@keyframes spin360 {
  from { transform: rotate(0deg); }
  to   { transform: rotate(360deg); }
}

@keyframes gradientShift {
  0%   { background-position: 0% 50%; }
  50%  { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

@keyframes shimmerLoad {
  0%   { background-position: -200% 0; }
  100% { background-position: 200% 0; }
}

@keyframes countPulse {
  0%   { transform: scale(1); }
  50%  { transform: scale(1.05); }
  100% { transform: scale(1); }
}

/* ==========================================================================
   HEADER
   ========================================================================== */

.header {
  position: sticky;
  top: 0;
  z-index: 100;
  background: linear-gradient(180deg, var(--base) 0%, var(--base) 70%, rgba(6,14,21,0) 100%);
  padding: 16px 24px 0;
}

.header-inner {
  max-width: 1600px;
  margin: 0 auto;
  display: flex;
  align-items: flex-end;
  justify-content: space-between;
  gap: 16px;
  padding-bottom: 16px;
}

.header-brand {
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.header-company {
  font-family: 'Chakra Petch', sans-serif;
  font-size: 12px;
  font-weight: 600;
  letter-spacing: 0.3em;
  text-transform: uppercase;
  color: var(--text-muted);
}

.header-title {
  font-family: 'Chakra Petch', sans-serif;
  font-size: 38px;
  font-weight: 700;
  color: #fff;
  line-height: 1;
  text-shadow: 0 0 30px rgba(126,217,182,0.25), 0 0 60px rgba(126,217,182,0.08);
  animation: pulseGlow 2s ease-in-out infinite;
}

.header-controls {
  display: flex;
  align-items: center;
  gap: 14px;
  padding-bottom: 6px;
}

.live-indicator {
  display: flex;
  align-items: center;
  gap: 7px;
}

.live-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: var(--shipped);
  animation: pulseLive 2s infinite;
  flex-shrink: 0;
}

.live-label {
  font-family: 'JetBrains Mono', monospace;
  font-size: 11px;
  font-weight: 600;
  color: var(--shipped);
  letter-spacing: 0.08em;
}

.header-sep {
  width: 1px;
  height: 20px;
  background: var(--border);
}

.last-updated {
  font-family: 'JetBrains Mono', monospace;
  font-size: 11px;
  color: var(--text-muted);
}

.refresh-btn {
  width: 34px;
  height: 34px;
  border-radius: 8px;
  border: 1px solid var(--border);
  background: var(--surface);
  color: var(--text-dim);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: border-color 0.2s, color 0.2s, background 0.2s;
}

.refresh-btn:hover {
  border-color: var(--mint);
  color: var(--mint);
  background: var(--surface-2);
}

.refresh-btn.spinning .refresh-icon {
  animation: spin360 0.8s linear infinite;
}

.refresh-icon {
  width: 16px;
  height: 16px;
  display: block;
}

/* Gradient line below header */
.header-line {
  height: 2px;
  max-width: 1600px;
  margin: 0 auto;
  background: linear-gradient(90deg, var(--mint), rgba(126,217,182,0.3), transparent, rgba(126,217,182,0.3), var(--mint));
  background-size: 200% 100%;
  animation: gradientShift 6s ease-in-out infinite;
  border-radius: 1px;
}

/* ==========================================================================
   DASHBOARD CONTAINER
   ========================================================================== */

.dashboard {
  max-width: 1600px;
  margin: 0 auto;
  padding: 24px 24px 40px;
}

/* ==========================================================================
   SECTION TITLES
   ========================================================================== */

.section-title {
  font-family: 'Barlow Semi Condensed', sans-serif;
  font-size: 12px;
  font-weight: 600;
  letter-spacing: 0.14em;
  text-transform: uppercase;
  color: var(--text-muted);
  margin-bottom: 16px;
  padding-left: 2px;
}

/* ==========================================================================
   METRICS RIBBON
   ========================================================================== */

.metrics-ribbon {
  display: grid;
  grid-template-columns: repeat(6, 1fr);
  gap: 10px;
  margin-bottom: 32px;
}

@media (max-width: 1000px) {
  .metrics-ribbon { grid-template-columns: repeat(3, 1fr); }
}

@media (max-width: 600px) {
  .metrics-ribbon { grid-template-columns: repeat(2, 1fr); }
}

.metric-card {
  background: var(--surface);
  border: 1px solid var(--border-subtle);
  border-radius: 10px;
  padding: 16px 18px 14px;
  display: flex;
  flex-direction: column;
  gap: 6px;
  position: relative;
  overflow: hidden;
  transition: border-color 0.25s;
}

.metric-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 3px;
  background: var(--metric-accent, var(--mint));
  border-radius: 10px 10px 0 0;
}

.metric-card:hover {
  border-color: var(--border);
}

.metric-value {
  font-family: 'JetBrains Mono', monospace;
  font-size: 38px;
  font-weight: 700;
  line-height: 1;
  color: var(--metric-accent, var(--mint));
}

.metric-label {
  font-family: 'Barlow Semi Condensed', sans-serif;
  font-size: 11px;
  font-weight: 600;
  letter-spacing: 0.1em;
  text-transform: uppercase;
  color: var(--text-dim);
}

/* Skeleton loading state for metrics */
.metric-value.skeleton {
  width: 60px;
  height: 38px;
  background: linear-gradient(90deg, var(--surface-2) 25%, var(--border-subtle) 50%, var(--surface-2) 75%);
  background-size: 200% 100%;
  animation: shimmerLoad 1.5s infinite;
  border-radius: 4px;
  color: transparent !important;
}

/* ==========================================================================
   GRID LAYERS
   ========================================================================== */

.grid-layers {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
  gap: 12px;
  margin-bottom: 36px;
}

.layer-card {
  background: var(--surface);
  border: 1px solid var(--border-subtle);
  border-left: 4px solid var(--layer-color, var(--mint));
  border-radius: 10px;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  opacity: 0;
  transform: translateY(12px);
  transition: border-color 0.25s, box-shadow 0.3s;
}

.layer-card.visible {
  animation: fadeSlideIn 0.3s ease-out forwards;
}

.layer-card:hover {
  border-color: var(--layer-color, var(--mint));
  box-shadow: 0 0 20px rgba(126,217,182,0.06), inset 0 0 20px rgba(126,217,182,0.02);
}

.layer-head {
  padding: 14px 16px 12px;
  display: flex;
  align-items: center;
  gap: 10px;
}

.layer-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: var(--layer-color, var(--mint));
  flex-shrink: 0;
}

.layer-name {
  font-family: 'Chakra Petch', sans-serif;
  font-size: 14px;
  font-weight: 700;
  letter-spacing: 0.04em;
  text-transform: uppercase;
  color: var(--text);
  flex: 1;
  min-width: 0;
}

.layer-stat {
  font-family: 'JetBrains Mono', monospace;
  font-size: 11px;
  color: var(--text-dim);
  flex-shrink: 0;
}

.layer-items {
  padding: 6px 10px 10px;
  display: flex;
  flex-direction: column;
  gap: 2px;
  max-height: 220px;
  overflow-y: auto;
  flex: 1;
}

.layer-empty {
  padding: 20px 16px;
  text-align: center;
  font-size: 13px;
  color: var(--text-muted);
  font-style: italic;
}

/* Task row inside layer cards */
.layer-task {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 7px 10px;
  border-radius: 6px;
  text-decoration: none;
  color: inherit;
  transition: background 0.15s;
}

.layer-task:hover {
  background: var(--surface-2);
}

.layer-task-dot {
  width: 6px;
  height: 6px;
  border-radius: 50%;
  flex-shrink: 0;
}

.layer-task-name {
  font-size: 13px;
  font-weight: 500;
  flex: 1;
  min-width: 0;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  color: var(--text);
}

.layer-task-status {
  font-family: 'JetBrains Mono', monospace;
  font-size: 10px;
  font-weight: 600;
  padding: 2px 8px;
  border-radius: 4px;
  text-transform: uppercase;
  letter-spacing: 0.04em;
  white-space: nowrap;
  flex-shrink: 0;
}

/* Status pill variations */
.pill-shipped {
  background: rgba(52,211,153,0.12);
  color: var(--shipped);
  box-shadow: inset 0 0 6px rgba(52,211,153,0.08);
}

.pill-building {
  background: rgba(251,191,36,0.12);
  color: var(--building);
  box-shadow: inset 0 0 6px rgba(251,191,36,0.08);
}

.pill-backlog {
  background: rgba(100,116,139,0.15);
  color: var(--backlog);
  box-shadow: inset 0 0 6px rgba(100,116,139,0.06);
}

.pill-concept {
  background: rgba(167,139,250,0.12);
  color: var(--concept);
  box-shadow: inset 0 0 6px rgba(167,139,250,0.08);
}

.pill-default {
  background: rgba(61,90,115,0.2);
  color: var(--text-dim);
}

/* ==========================================================================
   BUILD PIPELINE
   ========================================================================== */

.pipeline-section {
  margin-bottom: 36px;
}

.pipeline-table {
  background: var(--surface);
  border: 1px solid var(--border-subtle);
  border-radius: 10px;
  overflow: hidden;
}

.pipeline-head {
  display: grid;
  grid-template-columns: 32px 1fr 110px 80px 44px;
  gap: 10px;
  padding: 10px 18px;
  border-bottom: 1px solid var(--border-subtle);
  font-family: 'Barlow Semi Condensed', sans-serif;
  font-size: 11px;
  font-weight: 600;
  letter-spacing: 0.1em;
  text-transform: uppercase;
  color: var(--text-muted);
}

.pipeline-body {
  max-height: 400px;
  overflow-y: auto;
}

.pipeline-row {
  display: grid;
  grid-template-columns: 32px 1fr 110px 80px 44px;
  gap: 10px;
  padding: 10px 18px;
  border-bottom: 1px solid var(--border-subtle);
  align-items: center;
  text-decoration: none;
  color: inherit;
  transition: background 0.15s, border-color 0.2s;
}

.pipeline-row:last-child {
  border-bottom: none;
}

.pipeline-row:hover {
  background: var(--surface-2);
}

/* Priority dot */
.pri-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  justify-self: center;
}

.pri-urgent { background: var(--urgent); }
.pri-high   { background: var(--building); }
.pri-normal { background: var(--mint); }
.pri-low    { background: var(--backlog); }

.pipeline-name {
  font-size: 13px;
  font-weight: 500;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  color: var(--text);
}

.pipeline-date {
  font-family: 'JetBrains Mono', monospace;
  font-size: 11px;
  color: var(--text-muted);
}

.pipeline-link {
  width: 28px;
  height: 28px;
  border-radius: 6px;
  border: 1px solid var(--border-subtle);
  background: transparent;
  display: flex;
  align-items: center;
  justify-content: center;
  justify-self: center;
  transition: border-color 0.2s, background 0.2s;
}

.pipeline-row:hover .pipeline-link {
  border-color: var(--mint);
  background: var(--mint-glow);
}

.pipeline-link-arrow {
  width: 12px;
  height: 12px;
  display: block;
  stroke: var(--text-dim);
  fill: none;
  stroke-width: 2;
  stroke-linecap: round;
  stroke-linejoin: round;
}

.pipeline-row:hover .pipeline-link-arrow {
  stroke: var(--mint);
}

@media (max-width: 700px) {
  .pipeline-head,
  .pipeline-row {
    grid-template-columns: 32px 1fr 90px;
  }
  .pipeline-head > :nth-child(4),
  .pipeline-head > :nth-child(5),
  .pipeline-row > :nth-child(4),
  .pipeline-row > :nth-child(5) {
    display: none;
  }
}

/* ==========================================================================
   BOTTOM TWO-COLUMN SECTION
   ========================================================================== */

.bottom-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
  margin-bottom: 36px;
}

@media (max-width: 900px) {
  .bottom-grid {
    grid-template-columns: 1fr;
  }
}

/* --- Recent Activity --- */
.activity-panel {
  background: var(--surface);
  border: 1px solid var(--border-subtle);
  border-radius: 10px;
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

.activity-list {
  max-height: 440px;
  overflow-y: auto;
  flex: 1;
  position: relative;
}

/* Vertical timeline line */
.activity-list::before {
  content: '';
  position: absolute;
  top: 0;
  bottom: 0;
  left: 26px;
  width: 1px;
  background: var(--border-subtle);
  z-index: 0;
}

.activity-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 10px 18px;
  border-bottom: 1px solid var(--border-subtle);
  text-decoration: none;
  color: inherit;
  transition: background 0.15s;
  position: relative;
  z-index: 1;
}

.activity-item:last-child {
  border-bottom: none;
}

.activity-item:hover {
  background: var(--surface-2);
}

.activity-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  flex-shrink: 0;
  z-index: 2;
  border: 2px solid var(--surface);
  box-shadow: 0 0 0 1px var(--border-subtle);
}

.activity-info {
  flex: 1;
  min-width: 0;
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.activity-name {
  font-size: 13px;
  font-weight: 500;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  color: var(--text);
}

.activity-status-text {
  font-family: 'JetBrains Mono', monospace;
  font-size: 10px;
  color: var(--text-dim);
  text-transform: uppercase;
  letter-spacing: 0.04em;
}

.activity-time {
  font-family: 'JetBrains Mono', monospace;
  font-size: 11px;
  color: var(--text-muted);
  flex-shrink: 0;
  white-space: nowrap;
}

/* --- Content Pipeline --- */
.content-panel {
  background: var(--surface);
  border: 1px solid var(--border-subtle);
  border-radius: 10px;
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

.content-section-head {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 10px 18px;
  border-bottom: 1px solid var(--border-subtle);
}

.content-section-label {
  font-family: 'Barlow Semi Condensed', sans-serif;
  font-size: 12px;
  font-weight: 600;
  letter-spacing: 0.06em;
  text-transform: uppercase;
  color: var(--text-dim);
}

.content-badge {
  font-family: 'JetBrains Mono', monospace;
  font-size: 10px;
  font-weight: 600;
  padding: 2px 8px;
  border-radius: 10px;
  background: var(--surface-2);
  color: var(--text-dim);
}

.content-items {
  max-height: 200px;
  overflow-y: auto;
}

.content-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 8px 18px;
  border-bottom: 1px solid var(--border-subtle);
  text-decoration: none;
  color: inherit;
  transition: background 0.15s;
}

.content-item:last-child {
  border-bottom: none;
}

.content-item:hover {
  background: var(--surface-2);
}

.content-dot {
  width: 6px;
  height: 6px;
  border-radius: 50%;
  flex-shrink: 0;
}

.content-name {
  font-size: 13px;
  font-weight: 500;
  flex: 1;
  min-width: 0;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  color: var(--text);
}

.content-status {
  font-family: 'JetBrains Mono', monospace;
  font-size: 10px;
  font-weight: 600;
  padding: 2px 8px;
  border-radius: 4px;
  text-transform: uppercase;
  letter-spacing: 0.04em;
  white-space: nowrap;
  flex-shrink: 0;
}

/* ==========================================================================
   PANEL HEADER (reusable for Activity + Content panels)
   ========================================================================== */

.panel-header {
  padding: 14px 18px 12px;
  border-bottom: 1px solid var(--border-subtle);
}

.panel-title {
  font-family: 'Barlow Semi Condensed', sans-serif;
  font-size: 12px;
  font-weight: 600;
  letter-spacing: 0.14em;
  text-transform: uppercase;
  color: var(--text-muted);
}

/* ==========================================================================
   FOOTER
   ========================================================================== */

.footer {
  max-width: 1600px;
  margin: 0 auto;
  padding: 20px 24px 24px;
  text-align: center;
  border-top: 1px solid var(--border-subtle);
}

.footer-text {
  font-family: 'Barlow Semi Condensed', sans-serif;
  font-size: 12px;
  color: var(--text-muted);
  letter-spacing: 0.04em;
}

.footer-refresh {
  font-family: 'JetBrains Mono', monospace;
  font-size: 10px;
  color: var(--text-muted);
  margin-top: 4px;
  letter-spacing: 0.04em;
}

/* ==========================================================================
   SETUP / ERROR PANEL
   ========================================================================== */

.setup-panel {
  max-width: 520px;
  margin: 80px auto;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 14px;
  padding: 40px 36px;
  text-align: center;
}

.setup-icon {
  width: 48px;
  height: 48px;
  border-radius: 12px;
  background: var(--mint-glow);
  border: 1px solid var(--border);
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 0 auto 20px;
}

/* CSS-drawn lightning bolt shape */
.setup-icon::after {
  content: '';
  display: block;
  width: 0;
  height: 0;
  border-left: 6px solid transparent;
  border-right: 6px solid transparent;
  border-top: 14px solid var(--mint);
}

.setup-title {
  font-family: 'Chakra Petch', sans-serif;
  font-size: 18px;
  font-weight: 700;
  margin-bottom: 10px;
  color: var(--text);
}

.setup-desc {
  font-size: 14px;
  color: var(--text-dim);
  margin-bottom: 24px;
  line-height: 1.6;
}

.setup-steps {
  text-align: left;
  background: var(--surface-2);
  border-radius: 10px;
  padding: 20px 24px;
  margin-bottom: 20px;
}

.setup-steps ol {
  list-style: none;
  counter-reset: step;
}

.setup-steps li {
  counter-increment: step;
  font-size: 13px;
  color: var(--text-dim);
  padding: 6px 0 6px 32px;
  position: relative;
  line-height: 1.5;
}

.setup-steps li::before {
  content: counter(step);
  position: absolute;
  left: 0;
  top: 6px;
  width: 22px;
  height: 22px;
  border-radius: 50%;
  background: var(--surface);
  border: 1px solid var(--border);
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: 'JetBrains Mono', monospace;
  font-size: 10px;
  font-weight: 700;
  color: var(--text-muted);
  text-align: center;
  line-height: 22px;
}

.setup-steps code {
  font-family: 'JetBrains Mono', monospace;
  font-size: 11px;
  background: var(--surface);
  padding: 1px 6px;
  border-radius: 4px;
  color: var(--mint);
}

.setup-endpoint {
  font-family: 'JetBrains Mono', monospace;
  font-size: 11px;
  color: var(--text-muted);
  margin-top: 8px;
}

/* ==========================================================================
   EMPTY STATE
   ========================================================================== */

.empty-message {
  padding: 28px 18px;
  text-align: center;
  font-size: 13px;
  color: var(--text-muted);
}

/* ==========================================================================
   UTILITY
   ========================================================================== */

.visually-hidden {
  position: absolute;
  width: 1px;
  height: 1px;
  overflow: hidden;
  clip: rect(0,0,0,0);
  white-space: nowrap;
}
</style>
</head>
<body>

<!-- ====================================================================
     HEADER
     ==================================================================== -->
<div class="header">
  <div class="header-inner">
    <div class="header-brand">
      <div class="header-company">FOUNDRYSCALE</div>
      <div class="header-title">THE GRID</div>
    </div>
    <div class="header-controls">
      <div class="live-indicator">
        <span class="live-dot" id="liveDot"></span>
        <span class="live-label" id="liveLabel">CONNECTING</span>
      </div>
      <span class="header-sep"></span>
      <span class="last-updated font-mono" id="lastUpdated">--:--</span>
      <button class="refresh-btn" id="refreshBtn" title="Refresh data">
        <svg class="refresh-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="23 4 23 10 17 10"></polyline>
          <polyline points="1 20 1 14 7 14"></polyline>
          <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
        </svg>
      </button>
    </div>
  </div>
  <div class="header-line"></div>
</div>

<!-- ====================================================================
     DASHBOARD CONTENT
     ==================================================================== -->
<div class="dashboard" id="dashboardContent">

  <!-- Metrics Ribbon -->
  <div class="metrics-ribbon" id="metricsRibbon">
    <div class="metric-card" style="--metric-accent: var(--mint)">
      <div class="metric-value skeleton font-mono" id="metricAgents">--</div>
      <div class="metric-label">AGENTS</div>
    </div>
    <div class="metric-card" style="--metric-accent: var(--shipped)">
      <div class="metric-value skeleton font-mono" id="metricShipped">--</div>
      <div class="metric-label">SHIPPED</div>
    </div>
    <div class="metric-card" style="--metric-accent: var(--building)">
      <div class="metric-value skeleton font-mono" id="metricBuilding">--</div>
      <div class="metric-label">BUILDING</div>
    </div>
    <div class="metric-card" style="--metric-accent: var(--backlog)">
      <div class="metric-value skeleton font-mono" id="metricBacklog">--</div>
      <div class="metric-label">BACKLOG</div>
    </div>
    <div class="metric-card" style="--metric-accent: var(--mint)">
      <div class="metric-value skeleton font-mono" id="metricSprint">--</div>
      <div class="metric-label">SPRINT</div>
    </div>
    <div class="metric-card" style="--metric-accent: var(--concept)">
      <div class="metric-value skeleton font-mono" id="metricContent">--</div>
      <div class="metric-label">CONTENT</div>
    </div>
  </div>

  <!-- GRID Layers -->
  <div class="section-title">GRID LAYERS</div>
  <div class="grid-layers" id="gridLayers"></div>

  <!-- Build Pipeline -->
  <div class="pipeline-section" id="pipelineSection">
    <div class="section-title">BUILD PIPELINE</div>
    <div class="pipeline-table">
      <div class="pipeline-head">
        <div></div>
        <div>Task</div>
        <div>Status</div>
        <div>Due</div>
        <div></div>
      </div>
      <div class="pipeline-body" id="pipelineBody"></div>
    </div>
  </div>

  <!-- Bottom two-column section -->
  <div class="bottom-grid">

    <!-- Recent Activity -->
    <div class="activity-panel">
      <div class="panel-header">
        <div class="panel-title">RECENT ACTIVITY</div>
      </div>
      <div class="activity-list" id="activityList"></div>
    </div>

    <!-- Content Pipeline -->
    <div class="content-panel" id="contentPanel">
      <div class="panel-header">
        <div class="panel-title">CONTENT PIPELINE</div>
      </div>
      <div id="contentSections"></div>
    </div>

  </div>

</div>

<!-- ====================================================================
     SETUP PANEL (shown when data unavailable)
     ==================================================================== -->
<div id="setupPanel" style="display:none;">
  <div class="setup-panel">
    <div class="setup-icon"></div>
    <div class="setup-title">Dashboard Setup Required</div>
    <div class="setup-desc">
      This dashboard needs an n8n webhook workflow to pull live data from ClickUp.
    </div>
    <div class="setup-steps">
      <ol>
        <li>Import the workflow file: <code>workflows/grid-dashboard-data.json</code></li>
        <li>Open your n8n instance: <code>https://cprojects1.app.n8n.cloud</code></li>
        <li>Update the ClickUp API key in the Code node</li>
        <li>Activate the workflow</li>
        <li>Refresh this page</li>
      </ol>
    </div>
    <div class="setup-endpoint">
      Webhook: <code>/webhook/grid-dashboard</code>
    </div>
  </div>
</div>

<!-- ====================================================================
     FOOTER
     ==================================================================== -->
<div class="footer">
  <div class="footer-text">Powered by FoundryScale &times; n8n &times; ClickUp</div>
  <div class="footer-refresh">Refreshes every 5m</div>
</div>

<!-- ====================================================================
     JAVASCRIPT — Vanilla, production-grade, no external deps
     ==================================================================== -->
<script>
(function() {
  'use strict';

  /* ================================================================
     CONFIGURATION
     ================================================================ */

  var CONFIG = {
    WEBHOOK_URL: 'https://cprojects1.app.n8n.cloud/webhook/grid-dashboard?token=grid_fndry_7kX9mP2qR4wL',
    REFRESH_INTERVAL: 300000,
    CLICKUP_WORKSPACE: 'https://app.clickup.com/9014775277'
  };

  /* ================================================================
     LAYER DEFINITIONS
     Each layer maps to a key in the API response "layers" object.
     ================================================================ */

  var LAYERS = [
    { key: 'architect',  num: '01', name: 'ARCHITECT',  color: 'var(--layer-architect)',  hex: '#60A5FA' },
    { key: 'builder',    num: '02', name: 'BUILDER',    color: 'var(--layer-builder)',    hex: '#FBBF24' },
    { key: 'validator',  num: '03', name: 'VALIDATOR',  color: 'var(--layer-validator)',  hex: '#F87171' },
    { key: 'pm',         num: '04', name: 'PM',         color: 'var(--layer-pm)',         hex: '#7ED9B6' },
    { key: 'scout',      num: '05', name: 'SCOUT',      color: 'var(--layer-scout)',      hex: '#2DD4BF' },
    { key: 'librarian',  num: '06', name: 'LIBRARIAN',  color: 'var(--layer-librarian)',  hex: '#A78BFA' }
  ];

  /* ================================================================
     STATE
     ================================================================ */

  var refreshTimer = null;
  var dashboardData = null;
  var hasAnimatedCounters = false;

  /* ================================================================
     UTILITY FUNCTIONS
     ================================================================ */

  /**
   * Convert a Unix millisecond timestamp to a relative time string.
   * Handles string and number inputs, and timestamps in seconds.
   */
  function formatTimeAgo(timestamp) {
    if (!timestamp) return '--';
    var ts = typeof timestamp === 'string' ? parseInt(timestamp, 10) : timestamp;
    if (isNaN(ts)) return '--';
    /* Convert seconds to milliseconds if needed */
    if (ts < 1e12) ts = ts * 1000;
    var now = Date.now();
    var diff = now - ts;
    if (diff < 0) return 'just now';
    var secs = Math.floor(diff / 1000);
    if (secs < 60) return 'just now';
    var mins = Math.floor(secs / 60);
    if (mins < 60) return mins + 'm ago';
    var hrs = Math.floor(mins / 60);
    if (hrs < 24) return hrs + 'h ago';
    var days = Math.floor(hrs / 24);
    if (days < 30) return days + 'd ago';
    var months = Math.floor(days / 30);
    return months + 'mo ago';
  }

  /**
   * Format a Unix ms timestamp to "Feb 25" style date.
   */
  function formatDate(timestamp) {
    if (!timestamp) return '--';
    var ts = typeof timestamp === 'string' ? parseInt(timestamp, 10) : timestamp;
    if (isNaN(ts)) return '--';
    if (ts < 1e12) ts = ts * 1000;
    var d = new Date(ts);
    var months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
    return months[d.getMonth()] + ' ' + d.getDate();
  }

  /**
   * Map a status string to the appropriate CSS pill class.
   */
  function getStatusPillClass(status) {
    if (!status) return 'pill-default';
    var s = status.toLowerCase().trim();
    if (['shipped','complete','done','closed'].some(function(k) { return s.indexOf(k) !== -1; })) return 'pill-shipped';
    if (['in progress','building','in review'].some(function(k) { return s.indexOf(k) !== -1; })) return 'pill-building';
    if (['backlog','open','to do','todo','planned'].some(function(k) { return s.indexOf(k) !== -1; })) return 'pill-backlog';
    if (['concept','idea','draft'].some(function(k) { return s.indexOf(k) !== -1; })) return 'pill-concept';
    return 'pill-default';
  }

  /**
   * Map a status string to its CSS custom property color.
   */
  function getStatusColor(status) {
    var cls = getStatusPillClass(status);
    var map = {
      'pill-shipped':  'var(--shipped)',
      'pill-building': 'var(--building)',
      'pill-backlog':  'var(--backlog)',
      'pill-concept':  'var(--concept)',
      'pill-default':  'var(--text-muted)'
    };
    return map[cls] || 'var(--text-muted)';
  }

  /**
   * Map priority to a CSS class for the colored dot.
   */
  function getPriorityClass(priority) {
    if (!priority) return 'pri-normal';
    var p = (typeof priority === 'object') ? (priority.priority || '') : String(priority);
    var pl = p.toLowerCase();
    if (pl === 'urgent' || pl === '1') return 'pri-urgent';
    if (pl === 'high' || pl === '2') return 'pri-high';
    if (pl === 'normal' || pl === '3') return 'pri-normal';
    return 'pri-low';
  }

  /**
   * Animate a number from 0 to target on an element.
   * Uses requestAnimationFrame for smooth 60fps animation.
   */
  function countUp(element, target, duration) {
    if (typeof target !== 'number' || isNaN(target)) {
      element.textContent = target || '--';
      return;
    }
    var start = 0;
    var startTime = null;
    duration = duration || 800;

    function step(currentTime) {
      if (!startTime) startTime = currentTime;
      var progress = Math.min((currentTime - startTime) / duration, 1);
      /* Ease-out curve for smooth deceleration */
      var eased = 1 - Math.pow(1 - progress, 3);
      var current = Math.floor(eased * target);
      element.textContent = current;
      if (progress < 1) {
        requestAnimationFrame(step);
      } else {
        element.textContent = target;
      }
    }

    requestAnimationFrame(step);
  }

  /* ================================================================
     SAFE DOM HELPERS
     All rendering uses createElement + textContent, never innerHTML.
     ================================================================ */

  function clearElement(el) {
    while (el.firstChild) el.removeChild(el.firstChild);
  }

  function el(tag, className, textContent) {
    var node = document.createElement(tag);
    if (className) node.className = className;
    if (textContent !== undefined && textContent !== null) node.textContent = textContent;
    return node;
  }

  /* ================================================================
     FETCH DATA
     ================================================================ */

  function fetchDashboardData() {
    var btn = document.getElementById('refreshBtn');
    btn.classList.add('spinning');

    fetch(CONFIG.WEBHOOK_URL, {
      method: 'GET',
      headers: { 'Accept': 'application/json' }
    })
    .then(function(resp) {
      if (!resp.ok) throw new Error('HTTP ' + resp.status);
      return resp.json();
    })
    .then(function(data) {
      /* API may wrap payload in an array */
      if (Array.isArray(data)) data = data[0];
      dashboardData = data;
      renderDashboard(data);
      showDashboard();
      updateLiveStatus(true);
      updateLastUpdated();
    })
    .catch(function(err) {
      if (!dashboardData) showSetup();
      updateLiveStatus(false);
    })
    .finally(function() {
      btn.classList.remove('spinning');
    });
  }

  function manualRefresh() {
    fetchDashboardData();
    if (refreshTimer) clearInterval(refreshTimer);
    refreshTimer = setInterval(fetchDashboardData, CONFIG.REFRESH_INTERVAL);
  }

  /* ================================================================
     VISIBILITY TOGGLES
     ================================================================ */

  function showDashboard() {
    document.getElementById('dashboardContent').style.display = '';
    document.getElementById('setupPanel').style.display = 'none';
  }

  function showSetup() {
    document.getElementById('dashboardContent').style.display = 'none';
    document.getElementById('setupPanel').style.display = '';
  }

  function updateLiveStatus(connected) {
    var dot = document.getElementById('liveDot');
    var label = document.getElementById('liveLabel');
    if (connected) {
      dot.style.background = 'var(--shipped)';
      dot.style.animation = 'pulseLive 2s infinite';
      label.textContent = 'LIVE';
      label.style.color = 'var(--shipped)';
    } else {
      dot.style.background = 'var(--urgent)';
      dot.style.animation = 'none';
      label.textContent = 'OFFLINE';
      label.style.color = 'var(--urgent)';
    }
  }

  function updateLastUpdated() {
    var now = new Date();
    document.getElementById('lastUpdated').textContent =
      'Updated ' + now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true });
  }

  /* ================================================================
     RENDER ORCHESTRATOR
     ================================================================ */

  function renderDashboard(data) {
    renderMetrics(data.stats || {});
    renderGridLayers(data.layers || {});
    renderPipeline(data.buildPipeline || []);
    renderActivity(data.recentActivity || []);
    renderContent(data.content || {});
  }

  /* ================================================================
     RENDER: Metrics Ribbon
     ================================================================ */

  function renderMetrics(stats) {
    var fields = [
      { id: 'metricAgents',   value: stats.totalAgents },
      { id: 'metricShipped',  value: stats.shipped },
      { id: 'metricBuilding', value: stats.building },
      { id: 'metricBacklog',  value: stats.backlog },
      { id: 'metricSprint',   value: null, sprint: true },
      { id: 'metricContent',  value: stats.contentPipeline }
    ];

    fields.forEach(function(f) {
      var element = document.getElementById(f.id);
      element.classList.remove('skeleton');

      if (f.sprint) {
        /* Sprint shows "shipped/total" format */
        var shipped = stats.sprintShipped != null ? stats.sprintShipped : 0;
        var total = stats.sprintTotal != null ? stats.sprintTotal : 0;
        if (!hasAnimatedCounters) {
          element.textContent = '0/' + total;
          /* Animate only the shipped portion */
          var target = shipped;
          var duration = 800;
          var startTime = null;
          function animSprint(currentTime) {
            if (!startTime) startTime = currentTime;
            var progress = Math.min((currentTime - startTime) / duration, 1);
            var eased = 1 - Math.pow(1 - progress, 3);
            element.textContent = Math.floor(eased * target) + '/' + total;
            if (progress < 1) {
              requestAnimationFrame(animSprint);
            } else {
              element.textContent = shipped + '/' + total;
            }
          }
          requestAnimationFrame(animSprint);
        } else {
          element.textContent = shipped + '/' + total;
        }
        return;
      }

      var val = f.value != null ? f.value : 0;
      if (!hasAnimatedCounters) {
        countUp(element, val, 800);
      } else {
        element.textContent = val;
      }
    });

    hasAnimatedCounters = true;
  }

  /* ================================================================
     RENDER: GRID Layers
     ================================================================ */

  function renderGridLayers(layers) {
    var container = document.getElementById('gridLayers');
    clearElement(container);

    LAYERS.forEach(function(layer, index) {
      var layerData = layers[layer.key] || {};
      var tasks = extractLayerTasks(layer.key, layerData);

      var card = el('div', 'layer-card');
      card.style.setProperty('--layer-color', layer.color);

      /* Staggered fade-in animation */
      setTimeout(function() {
        card.classList.add('visible');
      }, index * 50);

      /* --- Card header --- */
      var head = el('div', 'layer-head');

      var dot = el('span', 'layer-dot');
      dot.style.background = layer.color;
      head.appendChild(dot);

      var name = el('span', 'layer-name font-display', layer.num + ' ' + layer.name);
      head.appendChild(name);

      var stat = el('span', 'layer-stat');
      stat.textContent = buildLayerStatText(layer.key, layerData, tasks);
      head.appendChild(stat);

      card.appendChild(head);

      /* --- Task items (max 4 visible) --- */
      if (tasks.length === 0) {
        card.appendChild(el('div', 'layer-empty', 'No items'));
      } else {
        var itemsContainer = el('div', 'layer-items');
        var maxShow = 4;
        var shown = tasks.slice(0, maxShow);

        shown.forEach(function(task) {
          var row = document.createElement('a');
          row.className = 'layer-task';
          row.href = task.url || '#';
          row.target = '_blank';
          row.rel = 'noopener';

          var taskDot = el('span', 'layer-task-dot');
          taskDot.style.background = task.statusColor || getStatusColor(task.status);
          row.appendChild(taskDot);

          row.appendChild(el('span', 'layer-task-name', task.name || 'Untitled'));

          if (task.status) {
            var pill = el('span', 'layer-task-status ' + getStatusPillClass(task.status), task.status);
            row.appendChild(pill);
          }

          itemsContainer.appendChild(row);
        });

        /* Show overflow count if more than 4 */
        if (tasks.length > maxShow) {
          var more = el('div', 'layer-task');
          more.style.justifyContent = 'center';
          var moreText = el('span', 'font-mono', '+' + (tasks.length - maxShow) + ' more');
          moreText.style.fontSize = '11px';
          moreText.style.color = 'var(--text-muted)';
          more.appendChild(moreText);
          itemsContainer.appendChild(more);
        }

        card.appendChild(itemsContainer);
      }

      container.appendChild(card);
    });
  }

  /**
   * Extract task arrays from different layer data shapes.
   * Each layer stores tasks differently in the API response.
   */
  function extractLayerTasks(key, data) {
    if (key === 'builder') {
      return [].concat(
        data.building || [],
        data.shipped || [],
        data.backlog || []
      );
    }
    if (key === 'pm') {
      return [].concat(
        data.sprintBoard || [],
        data.backlog || [],
        data.weeklyExec || []
      );
    }
    return data.items || [];
  }

  /**
   * Build descriptive stat text for a layer header.
   */
  function buildLayerStatText(key, data, tasks) {
    if (key === 'architect') {
      return (data.agentRegistry || tasks.length) + ' registered';
    }
    if (key === 'builder') {
      var building = (data.building || []).length;
      var shipped = (data.shipped || []).length;
      var bl = (data.backlog || []).length;
      return shipped + ' shipped, ' + building + ' active, ' + bl + ' backlog';
    }
    if (key === 'validator') {
      return (data.reviewQueue || 0) + ' review, ' + (data.systemHealth || 0) + ' health';
    }
    if (key === 'pm') {
      var sb = (data.sprintBoard || []).length;
      var bk = (data.backlog || []).length;
      return sb + ' sprint, ' + bk + ' backlog';
    }
    if (key === 'scout') {
      return (data.researchQueue || tasks.length) + ' research items';
    }
    if (key === 'librarian') {
      return tasks.length + ' items';
    }
    return tasks.length + ' items';
  }

  /* ================================================================
     RENDER: Build Pipeline
     ================================================================ */

  function renderPipeline(pipeline) {
    var container = document.getElementById('pipelineBody');
    clearElement(container);

    if (!pipeline || pipeline.length === 0) {
      container.appendChild(el('div', 'empty-message', 'No pipeline items'));
      return;
    }

    pipeline.forEach(function(task) {
      var row = document.createElement('a');
      row.className = 'pipeline-row';
      row.href = task.url || '#';
      row.target = '_blank';
      row.rel = 'noopener';

      /* Priority dot */
      var priDot = el('span', 'pri-dot ' + getPriorityClass(task.priority));
      row.appendChild(priDot);

      /* Task name */
      row.appendChild(el('span', 'pipeline-name', task.name || 'Untitled'));

      /* Status pill */
      var pill = el('span', 'layer-task-status ' + getStatusPillClass(task.status), task.status || '--');
      row.appendChild(pill);

      /* Due date */
      var dateText = task.dueDate ? formatDate(task.dueDate) : '--';
      row.appendChild(el('span', 'pipeline-date', dateText));

      /* External link icon */
      var linkWrap = el('span', 'pipeline-link');
      var svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
      svg.setAttribute('class', 'pipeline-link-arrow');
      svg.setAttribute('viewBox', '0 0 24 24');
      var path1 = document.createElementNS('http://www.w3.org/2000/svg', 'line');
      path1.setAttribute('x1', '7');
      path1.setAttribute('y1', '17');
      path1.setAttribute('x2', '17');
      path1.setAttribute('y2', '7');
      svg.appendChild(path1);
      var path2 = document.createElementNS('http://www.w3.org/2000/svg', 'polyline');
      path2.setAttribute('points', '7 7 17 7 17 17');
      svg.appendChild(path2);
      linkWrap.appendChild(svg);
      row.appendChild(linkWrap);

      container.appendChild(row);
    });
  }

  /* ================================================================
     RENDER: Recent Activity
     ================================================================ */

  function renderActivity(activity) {
    var container = document.getElementById('activityList');
    clearElement(container);

    if (!activity || activity.length === 0) {
      container.appendChild(el('div', 'empty-message', 'No recent activity'));
      return;
    }

    var items = activity.slice(0, 10);

    items.forEach(function(item) {
      var row = document.createElement('a');
      row.className = 'activity-item';
      row.href = item.url || '#';
      row.target = '_blank';
      row.rel = 'noopener';

      var dot = el('span', 'activity-dot');
      dot.style.background = item.statusColor || getStatusColor(item.status);
      row.appendChild(dot);

      var info = el('div', 'activity-info');
      info.appendChild(el('span', 'activity-name', item.name || 'Untitled'));

      if (item.status) {
        info.appendChild(el('span', 'activity-status-text', item.status));
      }

      row.appendChild(info);

      row.appendChild(el('span', 'activity-time', formatTimeAgo(item.dateUpdated)));

      container.appendChild(row);
    });
  }

  /* ================================================================
     RENDER: Content Pipeline
     ================================================================ */

  function renderContent(content) {
    var container = document.getElementById('contentSections');
    clearElement(container);

    var sections = [
      { label: 'TikTok Scripts', key: 'tiktokScripts', items: content.tiktokScripts || [] },
      { label: 'TikTok Takes',   key: 'tiktokTakes',   items: content.tiktokTakes || [] },
      { label: 'LinkedIn',       key: 'linkedin',       items: content.linkedin || [] }
    ];

    sections.forEach(function(section) {
      /* Section header with count badge */
      var headRow = el('div', 'content-section-head');
      headRow.appendChild(el('span', 'content-section-label', section.label));

      var badge = el('span', 'content-badge font-mono', String(section.items.length));
      headRow.appendChild(badge);

      container.appendChild(headRow);

      /* Items */
      if (section.items.length === 0) {
        var emptyRow = el('div', 'content-item');
        var emptyText = el('span', 'content-name', 'No items');
        emptyText.style.color = 'var(--text-muted)';
        emptyText.style.fontStyle = 'italic';
        emptyRow.appendChild(emptyText);
        container.appendChild(emptyRow);
        return;
      }

      var itemsWrap = el('div', 'content-items');

      section.items.forEach(function(item) {
        var row = document.createElement('a');
        row.className = 'content-item';
        row.href = item.url || '#';
        row.target = '_blank';
        row.rel = 'noopener';

        var dot = el('span', 'content-dot');
        dot.style.background = item.statusColor || getStatusColor(item.status);
        row.appendChild(dot);

        row.appendChild(el('span', 'content-name', item.name || 'Untitled'));

        if (item.status) {
          var statusEl = el('span', 'content-status ' + getStatusPillClass(item.status), item.status);
          row.appendChild(statusEl);
        }

        itemsWrap.appendChild(row);
      });

      container.appendChild(itemsWrap);
    });
  }

  /* ================================================================
     EVENT BINDINGS
     ================================================================ */

  document.getElementById('refreshBtn').addEventListener('click', function() {
    manualRefresh();
  });

  /* ================================================================
     INITIALIZATION
     ================================================================ */

  fetchDashboardData();
  refreshTimer = setInterval(fetchDashboardData, CONFIG.REFRESH_INTERVAL);

})();
</script>

</body>
</html>
